<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MTG Life Counter (Google Sheets同期版)</title>
<style>
  body { background:#1b1b1b; color:#fff; font-family:sans-serif; text-align:center; margin:0; padding:1rem; }
  h1 { color:#ffcc66; }
  .player { margin:1rem auto; padding:1rem; background:#2b2b2b; border-radius:1rem; max-width:400px; }
  .life { font-size:3rem; margin:1rem 0; font-weight:bold; }
  button { font-size:1.5rem; margin:0 1rem; padding:0.5rem 1.5rem; border:none; border-radius:0.8rem; cursor:pointer; }
  .plus { background:#4CAF50; color:#fff; }
  .minus { background:#e74c3c; color:#fff; }
</style>
</head>
<body>
<h1>MTG Life Counter (Google Sheets同期版)</h1>

<div class="player">
  <h2>Player 1</h2>
  <div class="life" id="p1">--</div>
  <button class="plus" onclick="changeLife('p1', 1)">+1</button>
  <button class="minus" onclick="changeLife('p1', -1)">-1</button>
</div>

<div class="player">
  <h2>Player 2</h2>
  <div class="life" id="p2">--</div>
  <button class="plus" onclick="changeLife('p2', 1)">+1</button>
  <button class="minus" onclick="changeLife('p2', -1)">-1</button>
</div>

<script>
const scriptUrl = "https://script.google.com/macros/s/AKfycbzwt4TRCLcvz4FU1UxOXHUqvM3sTsVMqhyopWqEEcshZb71ws6pSdcIYmenXn930VcTdg/exec";

let life = { p1: 20, p2: 20 };

// 画面に反映
function renderLife() {
  document.getElementById("p1").innerText = life.p1;
  document.getElementById("p2").innerText = life.p2;
}

// Google Apps Scriptから現在値を取得
async function fetchLife() {
  try {
    const res = await fetch(scriptUrl);
    const data = await res.json();
    if (data.p1 !== undefined && data.p2 !== undefined) {
      life.p1 = parseInt(data.p1);
      life.p2 = parseInt(data.p2);
      renderLife();
    }
  } catch(e) {
    console.error("fetchLife error:", e);
  }
}

// Google Apps Scriptに更新を送る
async function updateLife() {
  try {
    await fetch(scriptUrl, {
      method: "POST",
      body: JSON.stringify(life),
      headers: { "Content-Type": "application/json" }
    });
  } catch(e) {
    console.error("updateLife error:", e);
  }
}

function changeLife(player, delta) {
  life[player] += delta;
  if (life[player] < 0) life[player] = 0;
  renderLife();
  updateLife();
}

// 3秒ごとに同期（ポーリング）
setInterval(fetchLife, 3000);

// 初期ロード時に取得
fetchLife();
</script>
</body>
</html>
